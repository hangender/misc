_weaponPool = [
"gms_k98",
"M9",
"M9SD",
"Makarov",
"MakarovSD",
"M16A2",
"M16A2GL",
"m16a4",
"m16a4_acg",
"M16A4_GL",
"M16A4_ACG_GL",
"M24",
"M40A3",
"M240",
"Mk_48",
"M249",
"M4A1",
"M4A1_Aim",
"M4SPR",
"M4A1_RCO_GL",
"M4A1_HWS_GL",
"MP5SD",
"MP5A5",
"PK",
"Pecheneg",
"SVD",
"SVD_CAMO",
"G36C",
"G36a",
"G36K",
"MG36",
"NVGoggles",
"ItemGPS",
"AK_47_M",
"AK_47_S",
"AK_74",
"AK_74_GL",
"AK_107_kobra",
"AK_107_GL_kobra",
"AK_107_GL_pso",
"AK_107_pso",
"AKS_74_kobra",
"AKS_74_pso",
"AKS_74_U",
"AKS_74_UN_kobra",
"RPK_74",
"bizon",
"bizon_silenced",
"Colt1911",
"DMR",
"ksvk",
"M1014",
"Saiga12K",
"VSS_vintorez",
"Winchester1866",
"MR43",
"Remington870",
"Remington870_lamp",
"M107_DZ",
"RH_deagle",
"RH_Deagleg",
"RH_Deagles",
"RH_Deaglem",
"RH_Deaglemz",
"RH_Deaglemzb",
"RH_anac",
"RH_anacg",
"RH_bull",
"RH_python",
"RH_browninghp",
"RH_p226",
"RH_p226s",
"RH_p38",
"RH_ppk",
"RH_mk22",
"RH_mk22sd",
"RH_mk22v",
"RH_mk22vsd",
"RH_usp",
"RH_uspsd",
"RH_uspm",
"RH_m1911",
"RH_m1911sd",
"RH_m1911old",
"RH_tt33",
"RH_mk2",
"RH_m93r",
"RH_m9",
"RH_m9sd",
"RH_m9c",
"RH_m9csd",
"RH_g18",
"RH_g17",
"RH_g17sd",
"RH_g19",
"RH_g19t",
"RH_vz61",
"RH_tec9",
"RH_muzi",
"RH_hk416",
"RH_hk416s",
"RH_hk416saim",
"RH_hk416seotech",
"RH_hk416sacog",
"RH_hk416sd",
"RH_hk416aim",
"RH_hk416eotech",
"RH_hk416acog",
"RH_hk416gl",
"RH_hk416glaim",
"RH_hk416gleotech",
"RH_hk416glacog",
"RH_hk416sgl",
"RH_hk416sglaim",
"RH_hk416sgleotech",
"RH_hk416sglacog",
"RH_hk417",
"RH_hk417aim",
"RH_hk417eotech",
"RH_hk417acog",
"RH_hk417sp",
"RH_hk417s",
"RH_hk417saim",
"RH_hk417seotech",
"RH_hk417sacog",
"RH_hk417sd",
"RH_hk417sgl",
"RH_hk417sglaim",
"RH_hk417sgleotech",
"RH_hk417sglacog",
"RH_ctar21",
"RH_ctar21glacog",
"RH_ctar21m",
"RH_ctar21mgl",
"RH_star21",
"RH_mas",
"RH_masaim",
"RH_maseotech",
"RH_masacog",
"RH_massd",
"RH_masb",
"RH_masbaim",
"RH_masbeotech",
"RH_masbacog",
"RH_masbsd",
"RH_acr",
"RH_acraim",
"RH_acreotech",
"RH_acracog",
"RH_acrgl",
"RH_acrglaim",
"RH_acrgleotech",
"RH_acrglacog",
"RH_acrb",
"RH_acrbaim",
"RH_acrbeotech",
"RH_acrbacog",
"RH_acrbgl",
"RH_acrbglaim",
"RH_acrbgleotech",
"RH_acrbglacog",
"RH_m14",
"RH_m14acog",
"RH_m14aim",
"RH_m14eot",
"RH_m21",
"RH_sc2",
"RH_sc2acog",
"RH_sc2aim",
"RH_sc2eot",
"RH_sc2shd",
"RH_sc2sp",
"RH_m1s",
"RH_m1sacog",
"RH_m1saim",
"RH_m1seot",
"RH_m1sshd",
"RH_m1ssp",
"RH_m1st",
"RH_m1stacog",
"RH_m1staim",
"RH_m1steot",
"RH_m1stshd",
"RH_m1stsp",
"m8_carbine",
"m8_carbineGL",
"m8_compact",
"m8_sharpshooter",
"m8_SAW",
"huntingrifle",
"USSOF_M16A3GL",
"BAF_LRR_scoped",
"BAF_LRR_scoped_W",
"BAF_NLAW_Launcher",
"BAF_L85A2_RIS_Holo",
"BAF_L85A2_UGL_Holo",
"BAF_L85A2_RIS_SUSAT",
"BAF_L85A2_UGL_SUSAT",
"BAF_L85A2_RIS_ACOG",
"BAF_L85A2_UGL_ACOG",
"BAF_L85A2_RIS_CWS",
"BAF_L86A2_ACOG",
"BAF_L110A1_Aim",
"Sa61_EP1",
"UZI_EP1",
"UZI_SD_EP1",
"revolver_EP1",
"revolver_gold_EP1",
"glock17_EP1",
"M60A4_EP1",
"Mk_48_DES_EP1",
"M249_m145_EP1",
"M24_des_EP1",
"SVD_des_EP1",
"Sa58P_EP1",
"Sa58V_EP1",
"Sa58V_RCO_EP1",
"Sa58V_CCO_EP1",
"M4A3_CCO_EP1",
"M4A3_RCO_GL_EP1",
"Binocular_Vector",
"AK_74_GL_kobra",
"AKS_74",
"AKS_74_GOSHAWK",
"FN_FAL",
"FN_FAL_ANPVS4",
"G36C_camo",
"G36A_camo",
"G36K_camo",
"MG36_camo",
"M32_EP1",
"M79_EP1",
"Mk13_EP1",
"LeeEnfield",
"M14_EP1",
"m240_scoped_EP1",
"SCAR_L_CQC",
"SCAR_L_CQC_Holo",
"SCAR_L_STD_Mk4CQT",
"SCAR_L_STD_EGLM_RCO",
"SCAR_L_CQC_EGLM_Holo",
"SCAR_L_STD_HOLO",
"SCAR_H_CQC_CCO",
"SCAR_H_STD_EGLM_Spect",
"SCAR_H_LNG_Sniper",
"AA12_PMC",
"m8_carbine_pmc",
"m8_compact_pmc",
"FHQ_ACR_BASE",
"FHQ_ACR_GL_BASE",
"FHQ_ACR_WDL_IRN_GL",
"FHQ_ACR_WDL_CCO",
"FHQ_ACR_WDL_CCO_GL",
"FHQ_ACR_WDL_RCO",
"FHQ_ACR_WDL_RCO_GL",
"FHQ_ACR_WDL_HWS",
"FHQ_ACR_WDL_HWS_GL",
"FHQ_ACR_WDL_G33",
"FHQ_ACR_WDL_G33_GL",
"FHQ_ACR_WDL_HAMR",
"FHQ_ACR_WDL_HAMR_GL",
"FHQ_ACR_BLK_IRN",
"FHQ_ACR_BLK_IRN_GL",
"FHQ_ACR_BLK_CCO",
"FHQ_ACR_BLK_CCO_GL",
"FHQ_ACR_BLK_RCO",
"FHQ_ACR_BLK_RCO_GL",
"FHQ_ACR_BLK_HWS",
"FHQ_ACR_BLK_HWS_GL",
"FHQ_ACR_BLK_G33",
"FHQ_ACR_BLK_G33_GL",
"FHQ_ACR_BLK_HAMR",
"FHQ_ACR_BLK_HAMR_GL",
"FHQ_ACR_TAN_IRN",
"FHQ_ACR_TAN_IRN_GL",
"FHQ_ACR_TAN_CCO",
"FHQ_ACR_TAN_CCO_GL",
"FHQ_ACR_TAN_RCO",
"FHQ_ACR_TAN_RCO_GL",
"FHQ_ACR_TAN_HWS",
"FHQ_ACR_TAN_HWS_GL",
"FHQ_ACR_TAN_G33",
"FHQ_ACR_TAN_G33_GL",
"FHQ_ACR_TAN_HAMR",
"FHQ_ACR_TAN_HAMR_GL",
"FHQ_ACR_SNW_IRN",
"FHQ_ACR_SNW_IRN_GL",
"FHQ_ACR_SNW_CCO",
"FHQ_ACR_SNW_CCO_GL",
"FHQ_ACR_SNW_RCO",
"FHQ_ACR_SNW_RCO_GL",
"FHQ_ACR_SNW_HWS",
"FHQ_ACR_SNW_HWS_GL",
"FHQ_ACR_SNW_G33",
"FHQ_ACR_SNW_G33_GL",
"FHQ_ACR_SNW_HAMR",
"FHQ_ACR_SNW_HAMR_GL",
"FHQ_MSR_DESERT",
"FHQ_RSASS_TAN",
"FHQ_XM2010_DESERT",
"vil_SKS",
"vil_Tt33",
"vil_APS",
"vil_apssd",
"Vil_PYA",
"vil_PKP",
"vil_PKP_EOT",
"vil_PK",
"vil_zastava_m84",
"vil_PKM_N",
"vil_RPK",
"vil_RPK75",
"vil_RPK75_Romania",
"vil_RPK75_M72",
"vil_RPD",
"vil_RPK74M_P29",
"vil_RPK74M",
"vil_RPK74M_N",
"vil_VSS_PSO",
"vil_VSS_N",
"vil_VAL",
"vil_VAL_C",
"vil_Vikhr",
"vil_9a91",
"vil_9a91_c",
"vil_9a91_csd",
"vil_vsk94",
"vil_Groza_HG",
"vil_Groza_SC",
"vil_Groza_GL",
"vil_AKS_47",
"vil_AK_47_49",
"vil_AK_47",
"vil_AKMSB",
"vil_AKM_GL",
"vil_AKMS",
"vil_AKMS_GP25",
"vil_AK_47_m1",
"vil_AK_nato_m1",
"vil_M70",
"vil_M70B",
"vil_M64",
"vil_ASH82",
"vil_AMD",
"vil_AMD63",
"vil_PMI",
"vil_PMIS",
"vil_MPi",
"vil_AK_nato_m80",
"Vil_AKS_74_UN_kobra",
"Vil_AKS_74_UB",
"vil_AK_74_N",
"vil_AKS_74_gp",
"vil_AKS_74p",
"vil_AK_74P",
"vil_AKS_74p_gp",
"vil_AK_74m",
"vil_AK_74M_N",
"vil_AK_74M_PSO",
"vil_AK_74m_k",
"vil_AK_74m_EOT",
"vil_AK_74m_EOT_Alfa",
"vil_AK_74m_EOT_FSB",
"vil_AK_74m_EOT_FSB_45",
"vil_AK_74m_EOT_FSB_60",
"vil_AK_74m_c",
"vil_AK_74m_p29",
"vil_AK_74m_gp_29",
"vil_AK_74m_gp",
"vil_type88_1",
"vil_PMI74S",
"vil_Rak74sgl",
"vil_AK_101",
"vil_AK_103",
"vil_AK_105",
"Vil_AK_105_c",
"vil_AK_107",
"vil_SVU_A",
"vil_SVU",
"vil_PSL1",
"vil_M76",
"vil_M91",
"vil_SVD_63",
"vil_SVD_N",
"vil_SVD_S",
"vil_SVD_M",
"vil_SVD_P21",
"vil_SVDK",
"vil_SV_98",
"vil_SV_98_69",
"vil_Abakan",
"vil_Abakan_gp",
"vil_Abakan_P29",
"vil_ak12",
"vil_ak12_ap",
"vil_ak12_gp",
"vil_AEK1",
"vil_AEK2",
"vil_AEK_GL",
"vil_AeK_3",
"vil_AeK_23",
"vil_AeK_3_K",
"vil_Glock_o",
"vil_USP",
"vil_USPSD",
"vil_USP45",
"vil_USP45SD",
"vil_MP5_EOTech",
"vil_MP5SD_EOTech",
"vil_uzi_c",
"vil_uzi",
"vil_uzi_SD",
"vil_uzimini",
"vil_uzimini_SD",
"vil_G3a3",
"vil_G3a2",
"vil_G3a4",
"vil_G3a4b",
"vil_G3an",
"vil_G3anb",
"vil_G3ZF",
"vil_G3zfb",
"vil_G3SG1",
"vil_G3sg1b",
"vil_G3TGS",
"vil_G3TGSb",
"vil_AG3",
"vil_AG3EOT",
"skavil_M60",
"skavil_M60e3",
"vil_Mg3",
"vil_M249_Para",
"vil_Minimi",
"vil_FnMag",
"vil_M240_B",
"vil_MG4",
"vil_MG4E",
"vil_SR25",
"vil_M110",
"vil_HK417s",
"vil_M21",
"vil_M21G",
"vil_m40a3",
"vil_M24b",
"vil_M14",
"vil_M14G",
"vil_Fal",
"vil_Fal_Para",
"vil_sg540",
"vil_sg542",
"vil_sg542f",
"vil_Insas",
"vil_Insas_lmg",
"vil_M16A1",
"VIL_M4",
"vil_M4_EOT",
"VIL_M4_aim",
"vil_HK33",
"vil_Galil",
"vil_Galil_arm",
"vil_G36KVA4",
"vil_G36KA4",
"vil_G36E",
"vil_G36a2",
"vil_AG36",
"vil_AG36A2",
"vil_AG36KV",
"vil_AG36KA4",
"vil_G36VA4",
"vil_G36VA4Eot",
"vil_G36KVZ",
"vil_G36KSK",
"vil_G36KSKdes",
"vil_G36KSKdesES",
"vil_G36CC",
"vil_G36KSKES",
"vil_G36KES",
"vil_G36KV3Des",
"vil_HK416_Aim",
"vil_HK416_IS",
"vil_HK416_EOT",
"vil_HK416_GL",
"VIL_HK416_EDR",
"vil_CG84T"
];

// get lootbox list
_listLootBox = (allMissionObjects "USVehicleBox_EP1");

// clean every lootbox 1st time and set it to permaloot
{
	_x setVariable ["permaLoot", true, false];
	clearWeaponCargoGlobal _x;
	clearMagazineCargoGlobal _x;
}forEach _listLootBox;

fn_addMagsToWeaponCargo =
{
	private ["_cargo", "_weapons", "_wCName", "_mags", "_muzzles", "_mCName", "_mDName",  "_mModel"];
	
	_cargo = _this select 0;
	_wCName =  _this select 1;
	
	_mags = [];
	_muzzles = getArray(configfile >> "cfgWeapons" >> _wCName >> "muzzles");
	
	if ((_muzzles select 0) == "this") then
	{
		_muzzles = [_wCName];
		_mags = getArray(configfile >> "cfgWeapons" >> _wCName >> "magazines");
	}
	else
	{
		{
			_muzzle = _x;
			_mags = _mags + getArray(configfile >> "cfgWeapons" >> _wCName >> _muzzle >> "magazines");
		}forEach _muzzles;
	};
	
	{
		_mCName = _x;
		_mDName = getText(configFile >> "cfgMagazines" >> _mCName >> "displayName");
		_mModel = getText(configFile >> "cfgMagazines" >> _mCName >> "model");

		if ((_mCName != "") && (_mCName != "SkinBase") && (_mDName != "") && (_mModel != "")) then
		{
			_cargo addMagazineCargoGlobal [_mCName, floor(random 4) + 3]; // 3 min 6 max
		};
	}forEach _mags;
};

while { true } do
{
	{
		// if noone is looting it right now delete content
		if ((count (_x nearEntities [["CAManBase"], 6])) == 0) then
		{
			clearWeaponCargoGlobal _x;
			clearMagazineCargoGlobal _x;
		};
		
		// spawn some weapons
		_numWeapons = (floor(random 3) + 2); // 2 min; 4 max
		
		for "_i" from 0 to _numWeapons - 1 do
		{
			_weapon = _weaponPool select floor random count _weaponPool;
			_x addWeaponCargoGlobal [_weapon, 1];
			[_x, _weapon] call fn_addMagsToWeaponCargo;		
		};
	}forEach _listLootBox;
	
	sleep (40*60);
};